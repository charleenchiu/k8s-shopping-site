# 功能說明書：管理多個微服務容器的配置檔 (`docker-compose.yml`)

### 檔案位置
- 路徑：`docker-compose.yml`

### 功能概述
此 `docker-compose.yml` 文件用於定義並管理 `k8s-shopping-site` 應用的多個微服務容器，包括 `site-service`、`user-service`、`product-service`、`order-service` 和 `payment-service`。每個微服務在內部網路中互相連接，並且容器的網路配置允許透過動態端口映射來進行外部訪問。

### 功能詳述

1. **Compose 版本**
   - 使用 `version: '3'`，適用於 Docker Compose 的第三版語法，提供廣泛的相容性和功能。

2. **服務定義**
   - 定義五個微服務，每個微服務都在不同的資料夾路徑下進行構建，並且有自己的端口和環境變數配置。

   #### site-service
   - **構建目錄**：從當前目錄構建。
   - **端口**：將容器內部的 3000 埠綁定到 `${SITE_PORT}`（環境變數指定的外部埠）。
   - **環境變數**：
     - 各微服務的 URL，提供內部網路訪問。
     - `NODE_ENV=production`：設定為生產模式。
     - `EC2_PRIVATE_IP`、`USE_CONTAINER`：從環境變數動態指定，用於配置應用的運行環境。
   - **網路**：加入 `backend` 網路，提供內部連接。

   #### user-service
   - **構建目錄**：`./src/user-service`
   - **端口**：容器 3001 埠映射到 `${USER_SERVICE_PORT}`（外部埠）。
   - **環境變數**：
     - `NODE_ENV=production`
     - `EC2_PRIVATE_IP`、`USE_CONTAINER`
   - **網路**：加入 `backend` 網路。

   #### product-service
   - **構建目錄**：`./src/product-service`
   - **端口**：容器 3002 埠映射到 `${PRODUCT_SERVICE_PORT}`。
   - **環境變數**：
     - `NODE_ENV=production`
     - `EC2_PRIVATE_IP`、`USE_CONTAINER`
   - **網路**：加入 `backend` 網路。

   #### order-service
   - **構建目錄**：`./src/order-service`
   - **端口**：容器 3003 埠映射到 `${ORDER_SERVICE_PORT}`。
   - **環境變數**：
     - `NODE_ENV=production`
     - `EC2_PRIVATE_IP`、`USE_CONTAINER`
   - **網路**：加入 `backend` 網路。

   #### payment-service
   - **構建目錄**：`./src/payment-service`
   - **端口**：容器 3004 埠映射到 `${PAYMENT_SERVICE_PORT}`。
   - **環境變數**：
     - `NODE_ENV=production`
     - `EC2_PRIVATE_IP`、`USE_CONTAINER`
   - **網路**：加入 `backend` 網路。

3. **網路設定**
   - 使用 `backend` 網路（bridge 模式）連接所有微服務，允許它們在內部互相通訊。

### 使用說明
1. 確保定義了各服務的端口環境變數（如 `SITE_PORT`、`USER_SERVICE_PORT` 等）以及 `EC2_PRIVATE_IP` 和 `USE_CONTAINER`。
2. 執行 `docker-compose up` 啟動所有服務，這些服務將自動加入 `backend` 網路，允許內部服務之間使用指定的 URL 通訊。
3. 應用啟動後，依照各服務的埠即可在外部進行測試。

### 特殊說明
此設計允許擴展各服務的配置，並適用於多容器架構開發和測試環境。