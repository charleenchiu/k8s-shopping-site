# 功能說明書：Shopping Site Flask 應用

## 1. 概述
本應用為一個簡單的購物網站，使用 Flask 框架構建，並透過轉發請求來訪問不同的微服務，包括使用者服務、產品服務、訂單服務和付款服務。應用通過根目錄提供微服務的訪問入口，並根據環境變數配置微服務的 URL。

## 2. 環境變數
在啟動應用時，可以設定以下環境變數，以指定不同環境（本地或 EKS 環境）中微服務的 URL：

- `USER_SERVICE_URL`: 使用者服務的 URL，預設為 `http://user-service:3001`
- `PRODUCT_SERVICE_URL`: 產品服務的 URL，預設為 `http://product-service:3002`
- `ORDER_SERVICE_URL`: 訂單服務的 URL，預設為 `http://order-service:3003`
- `PAYMENT_SERVICE_URL`: 付款服務的 URL，預設為 `http://payment-service:3004`
- `HOST`: 應用的主機地址，預設為 `localhost`
- `PORT`: 應用的埠號，預設為 `3000`

## 3. 路由設計

### 3.1 根目錄 `/`
- **功能**: 顯示歡迎訊息並列出可用的微服務鏈接。
- **返回格式**: HTML 格式的歡迎頁面，包含每個微服務的名稱及其對應的 URL。

### 3.2 微服務轉發路由
本應用設計了四個主要路由，將請求轉發至相應的微服務。這些路由支援 GET 和 POST 請求。

- **使用者服務** `/user-service`
  - **功能**: 轉發請求至使用者服務。
  - **轉發邏輯**: 使用 `requests` 模組，將請求的 HTTP 方法、標頭、數據和 cookies 轉發至設定的 `user_service_url`。

- **產品服務** `/product-service`
  - **功能**: 轉發請求至產品服務。
  - **轉發邏輯**: 與使用者服務相同，轉發請求至 `product_service_url`。

- **訂單服務** `/order-service`
  - **功能**: 轉發請求至訂單服務。
  - **轉發邏輯**: 將請求轉發至 `order_service_url`。

- **付款服務** `/payment-service`
  - **功能**: 轉發請求至付款服務。
  - **轉發邏輯**: 將請求轉發至 `payment_service_url`。

### 3.3 請求轉發邏輯
每個微服務的轉發函數都使用了相似的邏輯，以下是請求轉發的關鍵步驟：

1. 獲取請求方法（GET 或 POST）。
2. 組合微服務的 URL 與請求的完整路徑。
3. 將請求的標頭（排除 Host）、數據及 cookies 一併轉發。
4. 返回微服務的響應內容、狀態碼及標頭。

## 4. 啟動應用
當腳本作為主程式運行時，會從環境變數中獲取主機和埠號，並啟動 Flask 伺服器。預設主機為 `localhost`，埠號為 `3000`。

## 5. 使用示例
使用者可以通過瀏覽器訪問 `http://<host>:<port>/` 來查看歡迎頁面，並通過點擊鏈接來訪問不同的微服務 API。