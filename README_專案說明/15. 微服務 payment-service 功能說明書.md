# 功能說明書：Payment Service

## 一、概述

`payment-service` 是一個處理付款相關操作的微服務，基於 Node.js 和 Express 框架開發。該服務運行在指定的埠號上，並提供 HTTP 接口來回應付款管理的請求。

## 二、核心組件

### 1. `index.js`

`index.js` 是應用的主要入口檔案，負責啟動 Express 應用並設定付款相關的路由。

#### 主要功能：
- **引入 Express 模組**：透過 `const express = require('express');` 引入 Express 框架。
- **建立應用實例**：使用 `const app = express();` 建立一個新的 Express 應用實例。
- **設定主機**：根據環境變數 `HOST` 設定服務運行的主機名稱。
- **設定埠號**：根據環境變數 `PORT` 設定服務運行的埠號，默認為 `3004`。
- **路由定義**：
  - 當使用者訪問根路由 `/` 時，回應訊息 "Hi, this is payment-service!"。
  - 可以新增其他路由來處理付款請求、查詢交易紀錄等功能。
- **啟動伺服器**：使用 `app.listen(port, 'payment-service', () => { ... });` 監聽指定埠號，並在啟動時輸出訊息以確認服務狀態。

#### 程式範例：
```javascript
const express = require('express');
const app = express();
const port = process.env.PORT || 3004;

app.get('/', (req, res) => {
    res.send('Hi, this is payment-service!');
});

// 可以在這裡新增其他處理付款的路由，例如付款請求、查詢交易紀錄等
app.listen(port, host, () => {
    console.log(`Payment Service listening at http://${host}:${port}`);
});
```

### 2. `package.json`

`package.json` 檔案包含應用的基本資訊及依賴管理。

#### 主要功能：
- **應用名稱**：`"name": "payment-service"` 指定應用的名稱。
- **版本號**：`"version": "1.0.0"` 標示應用的版本。
- **主檔案**：`"main": "index.js"` 表示應用的主入口檔案。
- **指令集**：`"scripts"` 中定義了可以透過 `yarn` 執行的指令。
  - `"test": "node index.js"`：定義測試指令，實際上用於啟動應用。
- **依賴**：`"dependencies"` 中列出了應用所需的 npm 套件。
  - `express` 是主要的 Web 框架。

#### 程式範例：
```json
{
  "name": "payment-service",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "test": "node index.js"
  },
  "dependencies": {
    "express": "^4.21.1"
  }
}
```

### 3. `Dockerfile`

`Dockerfile` 定義了如何構建 `payment-service` 的 Docker 映像檔。

#### 主要功能：
- **基礎映像檔**：使用 Node.js 官方映像檔作為基礎，版本為 `14`。
- **設定工作目錄**：`WORKDIR /usr/src/app` 設定應用的工作目錄。
- **複製依賴檔案**：將 `package.json` 和 `package-lock.json` 複製到映像檔中。
- **安裝依賴**：使用 `RUN yarn install` 安裝應用所需的依賴。
- **複製應用程式程式碼**：將應用程式的所有程式碼複製到映像檔中。
- **開放埠號**：開放 `3004` 埠號以接收外部請求。
- **啟動指令**：使用 `CMD ["node", "index.js"]` 指定容器啟動時運行的指令。

#### 程式範例：
```dockerfile
# 使用 Node.js 官方映像檔
FROM node:14

# 設定工作目錄
WORKDIR /usr/src/app

# 複製 package.json 和 package-lock.json
COPY package*.json ./ 

# 安裝依賴
RUN npm install

# 複製應用程式程式碼
COPY . .

# 開放埠號
EXPOSE 3004

# 啟動應用程式
CMD ["node", "index.js"]
```

## 三、本機預覽使用說明

1. **啟動服務**：
   - 在終端中執行 `docker-compose up --build` 建置 docker 映像檔並運行服務。
2. **訪問服務**：
   - 使用瀏覽器或 HTTP 客戶端訪問 `http://localhost:3004/` 來查看服務的回應。

## 四、結論

`payment-service` 提供了一個簡單的付款管理接口，能夠回應基本的 HTTP 請求，並且具備擴充性以支持未來更多付款功能的開發。透過 Docker 的建置與部署，該服務可以輕鬆整合至更大的微服務架構中。