### 功能說明書：User Service

#### 1. 概述
User Service 是一個提供使用者資料管理功能的 API 服務，允許前端應用程式對使用者資料進行新增、查詢、更新和刪除操作。該服務基於 Node.js 與 Express 框架實現，並使用 MySQL 作為資料庫，提供 RESTful API 接口來操作使用者資料。

#### 2. 核心功能
1. **取得所有使用者資料**：提供一個 API 路由 `/users` 來取得資料庫中所有使用者的資料。
2. **透過 ID 取得特定使用者資料**：提供一個 API 路由 `/users/:id`，根據使用者 ID 查詢指定的使用者資料。
3. **新增使用者資料**：提供一個 API 路由，允許前端應用新增使用者資料。
4. **更新使用者資料**：提供一個 API 路由，允許前端應用更新指定使用者的資料。
5. **刪除使用者資料**：提供一個 API 路由，允許前端應用刪除指定 ID 的使用者資料。

#### 3. 架構設計
User Service 的核心設計分為兩個主要部分：

1. **後端服務**：
   - 使用 Node.js 與 Express 框架構建服務。
   - 通過 MySQL 資料庫儲存和管理使用者資料。
   - 透過路由提供各種 RESTful API，讓前端應用能夠進行資料操作。

2. **前端介面**：
   - 使用 React 實現的使用者管理頁面，允許使用者透過網頁介面進行 CRUD 操作。
   - 前端與後端通訊使用 Axios 库發送 HTTP 請求。

#### 4. 主要路由設計
- **GET /users**：返回所有使用者資料。
- **GET /users/:id**：返回指定 ID 的使用者資料。如果該使用者不存在，將返回 404 錯誤。
- **POST /users**：新增使用者資料，資料透過請求主體傳送。
- **PUT /users/:id**：根據使用者 ID 更新資料。
- **DELETE /users/:id**：根據使用者 ID 刪除資料。

#### 5. 主要功能檔案解釋

##### 5.1 後端服務 (user-service.js)
```javascript
import express from 'express'; // 引入 Express 框架
import promisePool from '../../dbConnectionPool.js'; // 引入資料庫連接池
import dotenv from 'dotenv'; // 引入 dotenv 來加載環境變數
import { join, dirname } from 'path'; 
import { fileURLToPath } from 'url';

const app = express(); // 創建 Express 應用

// 取得當前文件的絕對路徑並加載 .env 配置
dotenv.config({ path: join(__dirname, '../../.env') });

// 取得所有使用者資料
app.get('/users', async (req, res) => {
    try {
        const [rows, fields] = await promisePool.query('SELECT * FROM users');
        res.json(rows);
    } catch (err) {
        res.status(500).send(err);
    }
});

// 透過 ID 取得使用者資料
app.get('/users/:id', async (req, res) => {
    const userId = parseInt(req.params.id, 10);
    try {
        const [rows, fields] = await promisePool.query('SELECT * FROM users WHERE id = ?', [userId]);
        if (rows.length === 0) {
            return res.status(404).send('User not found');
        }
        res.json(rows[0]);
    } catch (err) {
        res.status(500).send(err);
    }
});

app.listen(process.env.USER_SERVICE_PORT, () => {
    console.log(`User service listening at ${process.env.USER_SERVICE_PORT}`);
});

export default app;
```

##### 5.2 前端介面 (UserCRUDPage.js)
```javascript
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import BootstrapTable from 'react-bootstrap-table-next';

// 設定 API 的 URL
const url = getUsersUrl();

const UserCRUDPage = () => {
    const [data, setData] = useState([]);
    const [formData, setFormData] = useState({ name: '' });

    useEffect(() => {
        fetchData();
    }, []);

    // 獲取資料
    const fetchData = async () => {
        try {
            const response = await axios.get(url);
            setData(response.data);
        } catch (error) {
            console.error('獲取使用者資料錯誤', error);
        }
    };

    // 新增使用者
    const handleAdd = async () => {
        try {
            await axios.post(url, formData);
            fetchData();
            setFormData({ name: '' });
        } catch (error) {
            console.error('新增使用者資料錯誤', error);
        }
    };

    return (
        <div className='container'>
            <h2>管理使用者</h2>
            <form>
                <div className='form-group'>
                    <label>名稱</label>
                    <input type='text' className='form-control' value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} />
                </div>
                <button type="button" className='btn btn-primary' onClick={handleAdd}>新增</button>
            </form>
            <BootstrapTable keyField='id' data={data} columns={[
                { dataField: 'id', text: 'ID' },
                { dataField: 'name', text: '名稱' },
            ]} />
        </div>
    );
};

export default UserCRUDPage;
```

#### 6. 測試說明
##### 6.1 後端測試 (user.test.js)
- 測試 GET 請求來驗證能否成功獲取所有使用者資料或特定使用者資料。
- 測試 GET 請求當使用者不存在時應返回 404 狀態碼。

##### 6.2 前端測試 (UserCRUDPage.test.js)
- 測試是否能成功顯示 "使用者管理" 標題。

#### 7. 部署配置
User Service 使用 Docker 部署。以下是 Dockerfile 配置：
- 第一階段構建：基於 Node.js 映像，安裝依賴並構建應用。
- 第二階段：將構建好的應用檔案複製到最小化的 Node.js 映像中，並運行應用。

```dockerfile
# 使用 Node.js 映像構建
FROM node:14 AS build
WORKDIR /user-service
COPY package.json yarn.lock ./
RUN yarn install
COPY . .
FROM node:14
WORKDIR /user-service
COPY --from=build /user-service .
RUN yarn install --only=production
EXPOSE 3003
CMD ["node", "src/user-service.js"]
```

#### 8. 總結
User Service 提供了管理使用者資料的基本功能，並支持前端介面的 CRUD 操作，後端通過 Express 提供 API 服務，並且設置了基於 MySQL 資料庫的資料存取。